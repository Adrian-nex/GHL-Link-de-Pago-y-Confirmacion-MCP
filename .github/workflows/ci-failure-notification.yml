name: CI Failure Notification

on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types: [completed]

jobs:
  notify-failure:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    name: Failure Notification
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v5
      
    - name: Failure Analysis
      run: |
        echo "❌ CI Pipeline failed!"
        echo "🔍 Analyzing failure..."
        echo "📊 Check the logs for details"
        echo "🛠️  Common fixes:"
        echo "   - Run 'python run_ci_checks.py' locally"
        echo "   - Check code formatting with 'black .'"
        echo "   - Check imports with 'isort .'"
        echo "   - Run tests with 'pytest'"
        
    - name: Generate Failure Report
      run: |
        echo "## CI Failure Report" > failure_report.md
        echo "**Date:** $(date)" >> failure_report.md
        echo "**Commit:** ${{ github.event.workflow_run.head_sha }}" >> failure_report.md
        echo "**Branch:** ${{ github.event.workflow_run.head_branch }}" >> failure_report.md
        echo "" >> failure_report.md
        echo "### Next Steps:" >> failure_report.md
        echo "1. Check the workflow logs" >> failure_report.md
        echo "2. Run local checks: \`python run_ci_checks.py\`" >> failure_report.md
        echo "3. Fix any formatting issues" >> failure_report.md
        echo "4. Re-run the workflow" >> failure_report.md
        
    - name: Upload Failure Report
      uses: actions/upload-artifact@v3
      with:
        name: failure-report
        path: failure_report.md
